Description: Add-on to cups-avahi.patch to support Apple AirPrint (printing from iPhone, iPad, iPod Touch to a CUPS server), patch is separate as this part is not in the upstream repository of cups-avahi.patch because it is not intencded to be submitted to CUPS upstream.
Author: Till Kamppeter <till.kamppeter@gmail.com>
Bug: https://bugs.launchpad.net/bugs/711779

--- a/scheduler/conf.c
+++ b/scheduler/conf.c
@@ -89,9 +89,9 @@
 {
   { "AccessLog",		&AccessLog,		CUPSD_VARTYPE_STRING },
   { "AutoPurgeJobs", 		&JobAutoPurge,		CUPSD_VARTYPE_BOOLEAN },
-#ifdef HAVE_DNSSD
+#if defined(HAVE_DNSSD) || defined(HAVE_AVAHI)
   { "BrowseDNSSDSubTypes",	&DNSSDSubTypes,		CUPSD_VARTYPE_STRING },
-#endif /* HAVE_DNSSD */
+#endif /* HAVE_DNSSD || HAVE_AVAHI */
   { "BrowseWebIF",		&BrowseWebIF,		CUPSD_VARTYPE_BOOLEAN },
   { "Browsing",			&Browsing,		CUPSD_VARTYPE_BOOLEAN },
   { "CacheDir",			&CacheDir,		CUPSD_VARTYPE_STRING },
@@ -737,9 +737,9 @@
   Browsing                 = CUPS_DEFAULT_BROWSING;
   DefaultShared            = CUPS_DEFAULT_DEFAULT_SHARED;
 
-#ifdef HAVE_DNSSD
-  cupsdSetString(&DNSSDSubTypes, "_cups,_print");
-#endif /* HAVE_DNSSD */
+#if defined(HAVE_DNSSD) || defined(HAVE_AVAHI)
+  cupsdSetString(&DNSSDSubTypes, "_cups,_print,_universal");
+#endif /* HAVE_DNSSD || HAVE_AVAHI */
 
   cupsdSetString(&LPDConfigFile, CUPS_DEFAULT_LPD_CONFIG_FILE);
   cupsdSetString(&SMBConfigFile, CUPS_DEFAULT_SMB_CONFIG_FILE);
--- a/scheduler/dirsvc.c
+++ b/scheduler/dirsvc.c
@@ -606,6 +606,9 @@
     keyvalue[count  ][0] = "pdl";
     keyvalue[count++][1] = p->pdl ? p->pdl : "application/postscript";
 
+    keyvalue[count  ][0] = "URF";
+    keyvalue[count++][1] = "none";
+
     if (get_auth_info_required(p, air_str, sizeof(air_str)))
     {
       keyvalue[count  ][0] = "air";
